
# CD-CM-VC-VCS-L2-02-版本控制系统基本使用规范文档

## 能力项  [版本控制]

# 简介

> 本文档定义了版本控制系统基本的使用规范。定义了分支管理策略，版本号定义以及版本管理流程。

# 前言

本文档定义了版本控制系统基本的使用规范。定义了分支管理策略，版本号定义以及版本管理流程。能够帮助项目解决文件的提交、检出、回溯历史、冲突解决、多人协作模式等问题。 

# 1.  目的

项目研发和管理过程中会产生许许多多的工作成果，例如文档、产成品和数据等，需要将这些文件分门别类、有条理地进行保存。

主要分为两大类：

（1）属于产品组成部分的工作成果，例如需求、源代码、测试用例、缺陷及产成品等。

（2）项目管理和机构支撑过程域产生的文档。这些文档虽然不是产品的组成部分，但是值得保存。

每个管理对象的主要属性有：名称、标识符、文件状态、版本、作者、日期等。所有对象都需要进行版本控制和管理，确保不会混淆、丢失。版本管理系统中的历史记录反映了软件的演化过程。

所有的项目成员都要使用版本管理软件来保护自己的工作成果。

基线（Baseline）由一组版本管理对象组成，这些版本管理对象构成了一个相对稳定的逻辑实体。基线中的版本管理对象被“冻结”了，不能再被任何人随意修改（见变更控制规程）。基线通常对应于开发过程中的里程碑（Milestone），一个产品可以有多个基线，也可以只有一个基线。基线的主要属性有：名称、标识符、版本、日期等。

鉴于版本管理的重要性和复杂性，机构还应当设立版本控制委员会（Version Control Board, VCB）。VCB是个虚拟小组，对版本管理各项活动拥有决策权（例如审批规范，审批版本计划及变更等）。VCB的决策采用“少数服从多数”原则。

# 2.   角色

项目经理，技术经理，开发团队成员和测试团队成员。

所有项目成员都必须遵照版本控制规程操作配置库。

# 3.  版本状态变迁规则

![代码分支](../../docs/imgs/code branch.png)

-  release 分支合并触发自动化部署过程

-  master 分支时常保持可以部署的状态

-  进行新的作业时要从 master 分支创建新的分支，新分支名称要具有描述性

- 在开发者新建的本地仓库分支中进行提交

-  在 Gitlab 端仓库创建 dev 分支，定期 push

- 需要帮助、反馈，或者 branch 已经准备 merging 时，创建 Merge Request，以 Merge  Request 进行交流

- 让其他开发者进行审查，确认作业完成后与 master 分支进行合并（合并的代码一定要测试）

- 与 master 分支合并后，立刻测试，保证 master 分支可用



# 4.   版本号发布规则

版本号的分配规则 x.y.z

- x: 在重大功能变更，或者版本不向下兼容+1，此时y z归零

- y: 在添加新功能或者删除已有功能+1 此时z归零

- z: 只在进行内部修改后+1.

# 5.   版本控制流程

**[第一步] 创建开发分支**

master分支一般用来发布稳定版本，dev分支（开发分支）用来发布开发版本。

在项目界面输入分支名称后，下面会跳出`Create branch`，点击即可创建。

分支创建完毕后，会自动跳转到dev分支。由于 dev 分支是从 master 分支上创建的，因此内容与 master 分支一致。

**[第二步] Fork项目到个人的仓库**

点击右上角的`Fork`，并选择开发者的账号（一般在第一个）。就可以 Fork 团队项目到个人仓库。

**[第三步] Clone项目到本地**

clone 的地址可以直接点击按钮复制。打开 git 命令行，输入指令和刚才复制的地址，回车即可克隆到本地。

使用 git branch 命令查看本地分支，发现本地只有 master 分支。使用 git branch -a 查看所有分支。

根据远程分支，我可以创建一个新的本地分支 dev，并把该项目的 dev 分支的内容放到本地 dev 分支。使用 git checkout -b dev origin/dev 创建一个 dev 分支（-b），并把远程 dev 分支（origin/dev）的内容放在该分支内。接着切换到该分支（checkout）。

**[第四步]和团队项目保持同步**

使用 git remote -v 命令来查看是否设置 upstream。

如果没有显示 upstream，则使用 git remote add upstream 团队项目地址。

执行 git fetch upstream 获取团队项目最新版本开始同步。

如果当前分支是 dev分支，执行 git merge upstream/dev 命令后，会将源分支（upstream/dev）合并到当前分支（dev）。

当团队成员对同一个文件进行修改后，merge 的时候有可能会出现冲突。可以打开每个冲突的文件，手工解决冲突；也可以借助冲突处理工具来解决冲突。

**[第五步] push 修改到自己的项目上**

解决冲突后，就可以使用 git push 命令将本地的修改同步到自己的 Gitlab 仓库上了。

**[第六步]请求合并到团队项目上**

本地提交到 git 服务器上后，开发者需要到 Gitlab 上进行 merge request 操作。

在发送请求之前，可以检查一下修改的文件并进行两者的对比。

注意 title 填写使用 WIP :前缀，可以防止该次 merge request 就绪前被 merge 。

在`Assign`栏选择 merge request 分发给管理员，然后点击`submit merge request`按钮。

**[第七步]团队项目负责人审核及同意合并请求**

团队负责人审核有三个要注意的地方

- 一定要看清楚是合并到哪个分支，避免合并代码到错误分支。

- 检查自动化测试流水线状态，只能合并完成并通过检查的合并请求。

- 所有合并代码必须填写对应的 Issue 编号。

团队项目负责人通过查看该合并请求对项目做了哪些修改做代码审核。这样如果有问题，可以及时发现，并关闭该合并请求。如果通过代码审核，点击合并按钮合并代码到目标分支。
